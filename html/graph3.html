<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Efficacité et Groupe Cible</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Efficacité et Groupe Cible</h1>
  <canvas id="chartPage3" width="400" height="200"></canvas>
  
  <script>
    fetch('../csvjson.json')
      .then(response => response.json())
      .then(data => {
        // Mapping pour les niveaux d'efficacité
        const efficiencyMapping = { "Bon": 80, "Mitigé": 50, "Aucun avis émis": 30 };

        // Préparation des données
        const datasets = {};
        data.forEach(row => {
          const group = row["Groupe ciblé"];
          const mode = row["Mode d'action"];
          const efficiency = efficiencyMapping[row["Niveau de satisfaction de l'utilisation de la méthode"]] || 0;

          // Vérification des données valides
          if (group && mode && efficiency > 0) {
            if (!datasets[mode]) {
              datasets[mode] = [];
            }
            datasets[mode].push({
              x: group,
              y: efficiency,
            });
          }
        });

        // Transformer les données en datasets pour Chart.js
        const chartDatasets = Object.keys(datasets).map(mode => ({
          label: mode,
          data: datasets[mode],
          backgroundColor: `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.5)`,
          borderColor: `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 1)`,
          borderWidth: 1,
        }));

        // Création du graphique
        new Chart(document.getElementById('chartPage3'), {
          type: 'scatter',
          data: {
            datasets: chartDatasets,
          },
          options: {
            responsive: true,
            scales: {
              x: {
                type: 'category',
                title: {
                  display: true,
                  text: 'Groupes ciblés',
                },
              },
              y: {
                title: {
                  display: true,
                  text: 'Efficacité moyenne (%)',
                },
                min: 0,
                max: 100,
              },
            },
            plugins: {
              legend: {
                display: true,
                position: 'bottom',
              },
            },
          },
        });
      })
      .catch(error => {
        console.error('Erreur lors du chargement des données :', error);
        alert("Impossible de charger les données !");
      });
  </script>
</body>
</html>
